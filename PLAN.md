# План разработки функций для кнопок "О чем статья?", "Тезисы" и "Пост для Telegram"

## Цель
Добавить функциональность для трех кнопок, которые обрабатывают распарсенную статью через AI и генерируют соответствующий контент на русском языке.

## Текущее состояние
- ✅ Реализован парсинг статей (`/api/parse`)
- ✅ Реализован перевод статей (`/api/translate`)
- ✅ Кнопки "О чем статья?", "Тезисы", "Пост для Telegram" присутствуют в UI
- ❌ Функция `handleSubmit` только парсит статью, не выполняет AI-обработку

## Порядок действий

### Этап 1: Создание API endpoints

#### 1.1. Создать API endpoint для "О чем статья?" (`/api/summary`)
**Файл:** `app/api/summary/route.ts`

**Действия:**
1. Создать папку `app/api/summary/`
2. Создать файл `route.ts` с обработчиком POST запросов
3. Реализовать логику:
   - Принять `content` (текст статьи) из запроса
   - Проверить наличие `OPENROUTER_API_KEY`
   - Отправить запрос к OpenRouter API с промптом:
     - System message: "You are an expert article analyzer. Provide a brief summary in Russian explaining what the article is about. Be concise and informative."
     - User message: "What is this article about? Summarize it in Russian:\n\n{content}"
   - Обработать ответ и вернуть результат
   - Добавить обработку ошибок (как в `/api/translate`)
   - Добавить fallback на альтернативный сервис при ошибке региона

**Ожидаемый результат:** API endpoint, который возвращает краткое описание статьи на русском языке

---

#### 1.2. Создать API endpoint для "Тезисы" (`/api/thesis`)
**Файл:** `app/api/thesis/route.ts`

**Действия:**
1. Создать папку `app/api/thesis/`
2. Создать файл `route.ts` с обработчиком POST запросов
3. Реализовать логику:
   - Принять `content` (текст статьи) из запроса
   - Проверить наличие `OPENROUTER_API_KEY`
   - Отправить запрос к OpenRouter API с промптом:
     - System message: "You are an expert at creating article summaries. Create a structured list of key points (theses) from the article in Russian. Format as a numbered or bulleted list."
     - User message: "Create key theses from this article in Russian:\n\n{content}"
   - Обработать ответ и вернуть результат
   - Добавить обработку ошибок
   - Добавить fallback на альтернативный сервис при ошибке региона

**Ожидаемый результат:** API endpoint, который возвращает структурированный список тезисов на русском языке

---

#### 1.3. Создать API endpoint для "Пост для Telegram" (`/api/telegram`)
**Файл:** `app/api/telegram/route.ts`

**Действия:**
1. Создать папку `app/api/telegram/`
2. Создать файл `route.ts` с обработчиком POST запросов
3. Реализовать логику:
   - Принять `content` (текст статьи) и опционально `title` из запроса
   - Проверить наличие `OPENROUTER_API_KEY`
   - Отправить запрос к OpenRouter API с промптом:
     - System message: "You are a social media content creator. Create an engaging Telegram post in Russian based on the article. Include emojis, use clear formatting, make it interesting and informative. Maximum 2000 characters."
     - User message: "Create a Telegram post in Russian based on this article:\n\nTitle: {title}\n\nContent: {content}"
   - Обработать ответ и вернуть результат
   - Добавить обработку ошибок
   - Добавить fallback на альтернативный сервис при ошибке региона

**Ожидаемый результат:** API endpoint, который возвращает готовый пост для Telegram на русском языке

---

### Этап 2: Обновление фронтенда

#### 2.1. Обновить функцию `handleSubmit` в `app/page.tsx`

**Действия:**
1. Изменить логику функции `handleSubmit`:
   - После успешного парсинга статьи (через `handleParse`)
   - В зависимости от `action` ('summary' | 'thesis' | 'telegram'):
     - Вызвать соответствующий API endpoint (`/api/summary`, `/api/thesis`, `/api/telegram`)
     - Передать распарсенный контент статьи
     - Для Telegram также передать заголовок статьи
   - Отобразить результат в блоке результата
   - Обработать ошибки и показать понятные сообщения на русском

2. Обновить состояние загрузки:
   - Показывать индикатор загрузки во время парсинга и AI-обработки
   - Обновлять `actionType` для правильного отображения заголовка результата

**Ожидаемый результат:** Кнопки полностью функциональны и генерируют соответствующий контент

---

### Этап 3: Обработка ошибок и улучшения

#### 3.1. Унифицировать обработку ошибок

**Действия:**
1. Во всех трех новых API endpoints:
   - Добавить проверку наличия распарсенных данных
   - Добавить валидацию входных данных
   - Обрабатывать ошибки OpenRouter API (регион, лимиты, авторизация)
   - Добавить fallback на альтернативный сервис (как в `/api/translate`)
   - Возвращать понятные сообщения об ошибках на русском языке

2. На фронтенде:
   - Показывать понятные сообщения об ошибках
   - Обрабатывать случаи, когда парсинг не удался
   - Показывать состояние загрузки на всех этапах

---

#### 3.2. Оптимизация промптов

**Действия:**
1. Протестировать каждый endpoint с разными статьями
2. Настроить промпты для лучшего качества результатов:
   - Для "О чем статья?" - сделать описание более структурированным
   - Для "Тезисы" - обеспечить четкую нумерацию и структуру
   - Для "Пост для Telegram" - оптимизировать длину и форматирование

---

### Этап 4: Тестирование

#### 4.1. Функциональное тестирование

**Действия:**
1. Протестировать каждую кнопку с разными статьями:
   - Короткие статьи (< 1000 символов)
   - Средние статьи (1000-5000 символов)
   - Длинные статьи (> 5000 символов)

2. Проверить обработку ошибок:
   - Недоступность OpenRouter API
   - Неверный API ключ
   - Неверный URL статьи
   - Ошибки парсинга

3. Проверить UI:
   - Корректное отображение загрузки
   - Правильное отображение результатов
   - Корректные заголовки в блоке результата

---

#### 4.2. Интеграционное тестирование

**Действия:**
1. Проверить полный flow:
   - Ввод URL → Парсинг → AI-обработка → Отображение результата
2. Проверить работу всех трех кнопок последовательно
3. Проверить работу при быстром переключении между кнопками

---

### Этап 5: Документация и финализация

#### 5.1. Обновить документацию

**Действия:**
1. Обновить `README.md`:
   - Добавить описание новых функций
   - Добавить информацию о новых API endpoints
   - Обновить примеры использования

2. Добавить комментарии в код:
   - Описать назначение каждого API endpoint
   - Добавить JSDoc комментарии для функций

---

## Технические детали

### Используемые технологии
- **Next.js 14** - фреймворк
- **OpenRouter API** - для AI-обработки
- **TypeScript** - типизация
- **React** - UI компоненты

### Структура API запросов
Все три endpoint будут использовать одинаковую структуру:
```typescript
POST /api/{summary|thesis|telegram}
Body: {
  content: string,  // Текст статьи
  title?: string    // Заголовок (опционально, для Telegram)
}
```

### Структура ответов
```typescript
{
  result: string  // Сгенерированный контент на русском языке
}
```

или при ошибке:
```typescript
{
  error: string  // Сообщение об ошибке на русском языке
}
```

---

## Приоритеты реализации

1. **Высокий приоритет:**
   - Создание API endpoints (Этап 1)
   - Обновление `handleSubmit` (Этап 2)

2. **Средний приоритет:**
   - Обработка ошибок (Этап 3.1)
   - Базовое тестирование (Этап 4.1)

3. **Низкий приоритет:**
   - Оптимизация промптов (Этап 3.2)
   - Расширенное тестирование (Этап 4.2)
   - Документация (Этап 5)

---

## Ожидаемый результат

После выполнения плана:
- ✅ Кнопка "О чем статья?" генерирует краткое описание статьи на русском
- ✅ Кнопка "Тезисы" генерирует структурированный список ключевых тезисов
- ✅ Кнопка "Пост для Telegram" генерирует готовый пост для публикации
- ✅ Все функции работают с обработкой ошибок и fallback механизмами
- ✅ Пользователь получает качественный результат на русском языке


